<?xml version="1.0" ?>
<sql>

	<query>
		update setting set content='1.0.0' where name = 'ionize_version';
	</query>

    <query>
        ALTER TABLE media ADD provider varchar(50) NOT NULL DEFAULT  '';
    </query>

    <query>
        CREATE TABLE api_key (
            id int(11) NOT NULL AUTO_INCREMENT,
            `key` varchar(40) NOT NULL,
            `level` int(2) NOT NULL,
            ignore_limits tinyint(1) NOT NULL DEFAULT '0',
            is_private tinyint(1) NOT NULL DEFAULT '0',
            ip_addresses text,
            date_created datetime,
            PRIMARY KEY (id)
        ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;
    </query>

    <query>
        CREATE TABLE api_log (
            id int(11) NOT NULL AUTO_INCREMENT,
            uri varchar(255) NOT NULL,
            method varchar(6) NOT NULL,
            params text,
            api_key varchar(40) NOT NULL,
            date_log datetime DEFAULT NULL,
            ip_address varchar(45) NOT NULL,
            authorized tinyint(1) NOT NULL,
            PRIMARY KEY (id)
        ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;
    </query>

    <query>
        CREATE TABLE event_log (
            id int(11) unsigned NOT NULL AUTO_INCREMENT,
            status varchar(50) DEFAULT NULL,
            message text,
            id_user int(11) DEFAULT NULL,
            email varchar(255) DEFAULT NULL,
            date_log datetime DEFAULT NULL,
            ip_address varchar(45) DEFAULT NULL,
            seen tinyint(1) NOT NULL DEFAULT '0',
            PRIMARY KEY (id)
        ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;
    </query>
    
    
    <query>DELETE FROM setting WHERE name='media_upload_mode';</query>
    <query>INSERT IGNORE INTO setting VALUES ('', 'upload_autostart', '1', '');</query>
    <query>INSERT IGNORE INTO setting VALUES ('', 'resize_on_upload', '1', '');</query>
    <query>INSERT IGNORE INTO setting VALUES ('', 'picture_max_width', '1200', '');</query>
    <query>INSERT IGNORE INTO setting VALUES ('', 'picture_max_height', '1200', '');</query>
    <query>INSERT IGNORE INTO setting VALUES ('', 'upload_mode', '', '');</query>


    <query>create table if not exists user as select * from users;</query>
    <query>alter table user change id_group id_role int(11) unsigned not null;</query>
    <query>alter table user add primary key(id_user);</query>
    <query>alter table user modify id_user int(11) unsigned auto_increment;</query>
    <query>drop table users;</query>

    <query>create table if not exists role as select * from user_groups;</query>
    <query>alter table role change id_group id_role int(11) not null AUTO_INCREMENT PRIMARY KEY;</query>
    <query>alter table role change level role_level int(11);</query>
    <query>alter table role change slug role_code varchar(50);</query>
    <query>alter table role change group_name role_name varchar(100);</query>
    <query>alter table role change description role_description tinytext;</query>
    <query>drop table user_groups;</query>

    <query>
        CREATE TABLE if not exists resource (
            id_resource int(11) NOT NULL AUTO_INCREMENT,
            id_parent int(11) unsigned DEFAULT '0',
            resource varchar(255) NOT NULL DEFAULT '',
            actions varchar(500) DEFAULT '',
            title varchar(255) DEFAULT '',
            description varchar(1000) DEFAULT '',
            PRIMARY KEY (id_resource),
            UNIQUE KEY resource_key (resource)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
    </query>


    <query>ALTER TABLE article CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE article_comment CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE article_lang CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE article_media CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE article_type CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE captcha CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE category CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE category_lang CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE element CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE element CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE element_definition CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE element_definition_lang CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE extend_field CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE extend_field_lang CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE extend_fields CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE ion_sessions CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE lang CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE login_tracker CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE media CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE media_lang CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE menu CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE module CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE module_setting CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE note CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE page CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE page_article CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE page_lang CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE page_media CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE setting CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE tag CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE tracker CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE type CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE url CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE user_groups CONVERT TO CHARACTER SET utf8;</query>
    <query>ALTER TABLE users CONVERT TO CHARACTER SET utf8;</query>
</sql>